{"ast":null,"code":"var _dec,\n    _class,\n    _jsxFileName = \"/home/javier/work/urbe/Feldspar-master/src/Components/SaveLoadModal/SaveFile/SaveModal.jsx\";\n\nimport \"../../../App.css\";\nimport React, { Component } from \"react\";\nimport { inject, observer } from \"mobx-react\";\nimport Modal from \"react-bootstrap/Modal\";\nimport ModalHeading from \"../../ModalHeading.jsx\";\nimport SaveFileList from \"../SaveFileList.jsx\";\nimport Button from \"react-bootstrap/Button\";\nimport axios from \"axios\";\nimport { BASE_URL, FLOOR_MODELS, REMOVE_MODEL, RETRIEVE_MODEL, UPLOAD_ASSET, UPDATE_ASSET_ENTRY, UPDATE_MODEL } from \"../../../Constants\";\nimport LargeAlert from \"../../LargeAlert.jsx\";\nimport $ from \"jquery\";\nlet SaveModal = (_dec = inject(\"store\"), _dec(_class = observer(_class = class SaveModal extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      isDisabled: false,\n      isError: false,\n      fileName: \"\",\n      fileNameTemp: \"\",\n      fileUri: \"\",\n      stateBlob: {},\n      saveFileList: [],\n      showModal: false,\n      copied: false,\n      overwrite: \"Save\"\n    };\n    this.handleClose = this.handleClose.bind(this);\n    this.uploadFile = this.uploadFile.bind(this);\n    this.updateSaveFileList = this.updateSaveFileList.bind(this);\n    this.handleInputChange = this.handleInputChange.bind(this);\n    this.handleClick = this.handleClick.bind(this);\n    this.handleRemove = this.handleRemove.bind(this);\n    this.handleShare = this.handleShare.bind(this);\n  }\n\n  handleClose() {\n    this.props.store.setSaveFileModal(false);\n    this.setState({\n      fileName: \"\",\n      fileUri: \"\",\n      showModal: false,\n      isError: false\n    });\n  }\n\n  handleShare() {\n    this.setState({\n      copied: true,\n      isError: false\n    });\n  }\n\n  async handleRemove(id) {\n    let token = this.props.store.getAccessToken;\n    let config = {\n      headers: {\n        Authorization: `Bearer ${token}`\n      }\n    };\n    let body = {\n      _id: id\n    };\n\n    try {\n      await axios.post(BASE_URL + FLOOR_MODELS + REMOVE_MODEL, body, config);\n      this.updateSaveFileList();\n    } catch (e) {\n      console.log(e);\n      this.setState({\n        isError: true\n      });\n    }\n  }\n\n  handleClick(name, uri, event) {\n    this.setState({\n      fileName: name,\n      fileUri: uri,\n      isError: false,\n      overwrite: \"Overwrite\"\n    });\n    $(\".save-file-list-item\").css(\"border-color\", \"#ffffff\");\n    event.currentTarget.style.borderColor = \"#5a6268\";\n  }\n\n  handleInputChange(event) {\n    $(\".save-file-list-item\").css(\"border-color\", \"#ffffff\");\n    this.setState({\n      fileName: event.target.value,\n      fileNameTemp: event.target.value,\n      isError: false,\n      overwrite: \"Save\"\n    });\n  }\n\n  async updateSaveFileList() {\n    let token = this.props.store.getAccessToken;\n    let config = {\n      headers: {\n        Authorization: `Bearer ${token}`\n      }\n    };\n\n    try {\n      let res = await axios.post(BASE_URL + FLOOR_MODELS + RETRIEVE_MODEL, {}, config);\n      this.setState({\n        saveFileList: res.data,\n        isError: false\n      });\n    } catch (e) {\n      console.log(e);\n      this.setState({\n        isError: true\n      });\n    }\n  }\n\n  async uploadFile(blob) {\n    if (!this.state.isDisabled && this.state.fileName !== \"\") {\n      const data = new FormData();\n      data.append(\"file\", blob);\n      let token = this.props.store.getAccessToken;\n      let config = {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      };\n\n      try {\n        let resFileId = await axios.post(BASE_URL + UPLOAD_ASSET, data, config);\n        let updateBody = {\n          _id: resFileId.data,\n          fileType: \"floorModel\",\n          extension: \"blueprint3d\"\n        };\n        await axios.post(BASE_URL + UPDATE_ASSET_ENTRY, updateBody, config);\n        let modelBody = {\n          name: this.state.fileName,\n          url: resFileId.data\n        };\n        await axios.post(BASE_URL + FLOOR_MODELS + UPDATE_MODEL, modelBody, config);\n        this.setState({\n          fileName: \"\",\n          isDisabled: false,\n          isError: false\n        });\n        this.updateSaveFileList();\n        this.handleClose();\n      } catch (e) {\n        console.log(e);\n        this.setState({\n          isDisabled: false,\n          isError: true\n        });\n      }\n    } else {\n      this.setState({\n        isDisabled: false,\n        isError: false\n      });\n    }\n  }\n\n  componentDidUpdate(prevProps, prevState, snapShot) {\n    if (prevState.stateBlob !== this.props.blob && this.props.blob !== null && this.props.blob !== \"\" && this.state.isDisabled === false) {\n      this.setState({\n        stateBlob: this.props.blob,\n        isDisabled: true,\n        isError: false,\n        overwrite: \"Save\"\n      });\n      this.uploadFile(this.props.blob);\n    }\n\n    if (this.props.store.showSaveFileModal && !prevState.showModal) {\n      this.setState({\n        showModal: true,\n        isError: false,\n        overwrite: \"Save\"\n      });\n      this.updateSaveFileList();\n    }\n  }\n\n  render() {\n    const {\n      store\n    } = this.props;\n    return /*#__PURE__*/React.createElement(Modal, {\n      \"aria-labelledby\": \"contained-modal-title-vcenter\",\n      centered: true,\n      show: store.showSaveFileModal,\n      onHide: () => this.handleClose(),\n      id: \"saveModal\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Modal.Header, {\n      closeButton: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 189,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Modal.Title, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(ModalHeading, {\n      icon: \"saveFile\",\n      message: \"Save Project\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 191,\n        columnNumber: 13\n      }\n    }))), /*#__PURE__*/React.createElement(Modal.Body, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"login-form-space\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 195,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(SaveFileList, {\n      clickFunc: this.handleClick,\n      removeFunc: this.handleRemove,\n      shareFunc: this.handleShare,\n      fileList: this.state.saveFileList,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"save-file-space\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"save-file-text\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 15\n      }\n    }, \"Save As: \"), /*#__PURE__*/React.createElement(\"input\", {\n      type: \"text\",\n      name: \"name\",\n      value: this.state.fileNameTemp,\n      className: \"save-file-input\",\n      onChange: this.handleInputChange,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 205,\n        columnNumber: 15\n      }\n    })), /*#__PURE__*/React.createElement(Button, {\n      variant: \"danger\",\n      className: \"login-submit-button\",\n      disabled: this.state.isDisabled,\n      onClick: this.props.clickFunc,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 13\n      }\n    }, this.state.overwrite), this.state.copied && /*#__PURE__*/React.createElement(LargeAlert, {\n      variant: \"success\",\n      message: \"Link Copied to Clipboard\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 223,\n        columnNumber: 15\n      }\n    }), this.state.isError && /*#__PURE__*/React.createElement(LargeAlert, {\n      variant: \"danger\",\n      message: \"Some Error Occurred\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 229,\n        columnNumber: 15\n      }\n    }))));\n  }\n\n}) || _class) || _class);\nexport default SaveModal;","map":{"version":3,"sources":["/home/javier/work/urbe/Feldspar-master/src/Components/SaveLoadModal/SaveFile/SaveModal.jsx"],"names":["React","Component","inject","observer","Modal","ModalHeading","SaveFileList","Button","axios","BASE_URL","FLOOR_MODELS","REMOVE_MODEL","RETRIEVE_MODEL","UPLOAD_ASSET","UPDATE_ASSET_ENTRY","UPDATE_MODEL","LargeAlert","$","SaveModal","constructor","props","state","isDisabled","isError","fileName","fileNameTemp","fileUri","stateBlob","saveFileList","showModal","copied","overwrite","handleClose","bind","uploadFile","updateSaveFileList","handleInputChange","handleClick","handleRemove","handleShare","store","setSaveFileModal","setState","id","token","getAccessToken","config","headers","Authorization","body","_id","post","e","console","log","name","uri","event","css","currentTarget","style","borderColor","target","value","res","data","blob","FormData","append","resFileId","updateBody","fileType","extension","modelBody","url","componentDidUpdate","prevProps","prevState","snapShot","showSaveFileModal","render","clickFunc"],"mappings":"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","sourcesContent":["import \"../../../App.css\";\nimport React, { Component } from \"react\";\nimport { inject, observer } from \"mobx-react\";\nimport Modal from \"react-bootstrap/Modal\";\nimport ModalHeading from \"../../ModalHeading.jsx\";\nimport SaveFileList from \"../SaveFileList.jsx\";\nimport Button from \"react-bootstrap/Button\";\nimport axios from \"axios\";\nimport {\n  BASE_URL,\n  FLOOR_MODELS,\n  REMOVE_MODEL,\n  RETRIEVE_MODEL,\n  UPLOAD_ASSET,\n  UPDATE_ASSET_ENTRY,\n  UPDATE_MODEL,\n} from \"../../../Constants\";\nimport LargeAlert from \"../../LargeAlert.jsx\";\nimport $ from \"jquery\";\n\n@inject(\"store\")\n@observer\nclass SaveModal extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      isDisabled: false,\n      isError: false,\n      fileName: \"\",\n      fileNameTemp: \"\",\n      fileUri: \"\",\n      stateBlob: {},\n      saveFileList: [],\n      showModal: false,\n      copied: false,\n      overwrite: \"Save\",\n    };\n\n    this.handleClose = this.handleClose.bind(this);\n    this.uploadFile = this.uploadFile.bind(this);\n    this.updateSaveFileList = this.updateSaveFileList.bind(this);\n    this.handleInputChange = this.handleInputChange.bind(this);\n    this.handleClick = this.handleClick.bind(this);\n    this.handleRemove = this.handleRemove.bind(this);\n    this.handleShare = this.handleShare.bind(this);\n  }\n\n  handleClose() {\n    this.props.store.setSaveFileModal(false);\n    this.setState({\n      fileName: \"\",\n      fileUri: \"\",\n      showModal: false,\n      isError: false,\n    });\n  }\n\n  handleShare() {\n    this.setState({ copied: true, isError: false });\n  }\n\n  async handleRemove(id) {\n    let token = this.props.store.getAccessToken;\n    let config = {\n      headers: { Authorization: `Bearer ${token}` },\n    };\n    let body = { _id: id };\n    try {\n      await axios.post(BASE_URL + FLOOR_MODELS + REMOVE_MODEL, body, config);\n      this.updateSaveFileList();\n    } catch (e) {\n      console.log(e);\n      this.setState({ isError: true });\n    }\n  }\n\n  handleClick(name, uri, event) {\n    this.setState({\n      fileName: name,\n      fileUri: uri,\n      isError: false,\n      overwrite: \"Overwrite\",\n    });\n    $(\".save-file-list-item\").css(\"border-color\", \"#ffffff\");\n    event.currentTarget.style.borderColor = \"#5a6268\";\n  }\n\n  handleInputChange(event) {\n    $(\".save-file-list-item\").css(\"border-color\", \"#ffffff\");\n    this.setState({\n      fileName: event.target.value,\n      fileNameTemp: event.target.value,\n      isError: false,\n      overwrite: \"Save\",\n    });\n  }\n\n  async updateSaveFileList() {\n    let token = this.props.store.getAccessToken;\n    let config = {\n      headers: { Authorization: `Bearer ${token}` },\n    };\n    try {\n      let res = await axios.post(\n        BASE_URL + FLOOR_MODELS + RETRIEVE_MODEL,\n        {},\n        config\n      );\n      this.setState({ saveFileList: res.data, isError: false });\n    } catch (e) {\n      console.log(e);\n      this.setState({ isError: true });\n    }\n  }\n\n  async uploadFile(blob) {\n    if (!this.state.isDisabled && this.state.fileName !== \"\") {\n      const data = new FormData();\n      data.append(\"file\", blob);\n      let token = this.props.store.getAccessToken;\n      let config = {\n        headers: { Authorization: `Bearer ${token}` },\n      };\n\n      try {\n        let resFileId = await axios.post(BASE_URL + UPLOAD_ASSET, data, config);\n\n        let updateBody = {\n          _id: resFileId.data,\n          fileType: \"floorModel\",\n          extension: \"blueprint3d\",\n        };\n        await axios.post(BASE_URL + UPDATE_ASSET_ENTRY, updateBody, config);\n\n        let modelBody = {\n          name: this.state.fileName,\n          url: resFileId.data,\n        };\n        await axios.post(\n          BASE_URL + FLOOR_MODELS + UPDATE_MODEL,\n          modelBody,\n          config\n        );\n\n        this.setState({ fileName: \"\", isDisabled: false, isError: false });\n        this.updateSaveFileList();\n        this.handleClose();\n      } catch (e) {\n        console.log(e);\n        this.setState({ isDisabled: false, isError: true });\n      }\n    } else {\n      this.setState({ isDisabled: false, isError: false });\n    }\n  }\n\n  componentDidUpdate(prevProps, prevState, snapShot) {\n    if (\n      prevState.stateBlob !== this.props.blob &&\n      this.props.blob !== null &&\n      this.props.blob !== \"\" &&\n      this.state.isDisabled === false\n    ) {\n      this.setState({\n        stateBlob: this.props.blob,\n        isDisabled: true,\n        isError: false,\n        overwrite: \"Save\",\n      });\n      this.uploadFile(this.props.blob);\n    }\n\n    if (this.props.store.showSaveFileModal && !prevState.showModal) {\n      this.setState({ showModal: true, isError: false, overwrite: \"Save\" });\n      this.updateSaveFileList();\n    }\n  }\n\n  render() {\n    const { store } = this.props;\n    return (\n      <Modal\n        aria-labelledby=\"contained-modal-title-vcenter\"\n        centered\n        show={store.showSaveFileModal}\n        onHide={() => this.handleClose()}\n        id=\"saveModal\"\n      >\n        <Modal.Header closeButton>\n          <Modal.Title>\n            <ModalHeading icon=\"saveFile\" message=\"Save Project\" />\n          </Modal.Title>\n        </Modal.Header>\n        <Modal.Body>\n          <div className=\"login-form-space\">\n            <SaveFileList\n              clickFunc={this.handleClick}\n              removeFunc={this.handleRemove}\n              shareFunc={this.handleShare}\n              fileList={this.state.saveFileList}\n            />\n\n            <div className=\"save-file-space\">\n              <div className=\"save-file-text\">Save As: </div>\n              <input\n                type=\"text\"\n                name=\"name\"\n                value={this.state.fileNameTemp}\n                className=\"save-file-input\"\n                onChange={this.handleInputChange}\n              />\n            </div>\n\n            <Button\n              variant=\"danger\"\n              className=\"login-submit-button\"\n              disabled={this.state.isDisabled}\n              onClick={this.props.clickFunc}\n            >\n              {this.state.overwrite}\n            </Button>\n            {this.state.copied && (\n              <LargeAlert\n                variant=\"success\"\n                message=\"Link Copied to Clipboard\"\n              />\n            )}\n            {this.state.isError && (\n              <LargeAlert variant=\"danger\" message=\"Some Error Occurred\" />\n            )}\n          </div>\n        </Modal.Body>\n      </Modal>\n    );\n  }\n}\n\nexport default SaveModal;\n"]},"metadata":{},"sourceType":"module"}